{"ast":null,"code":"// Firebase client initialization for Room24\n// Replace placeholder environment variables with real Firebase project config.\n// Ensure you have added a web app in Firebase console and enabled Cloud Messaging.\n\nimport { initializeApp } from 'firebase/app';\nimport { getMessaging, getToken, onMessage } from 'firebase/messaging';\nimport { getAnalytics, logEvent } from 'firebase/analytics';\nimport { getFirestore, collection, doc, getDocs, getDoc, setDoc, addDoc, updateDoc, deleteDoc, query, where, orderBy, onSnapshot, serverTimestamp } from 'firebase/firestore';\nimport { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signInWithPopup, GoogleAuthProvider, signOut as firebaseSignOut, onAuthStateChanged, updateProfile, sendPasswordResetEmail, RecaptchaVerifier, signInWithPhoneNumber, PhoneAuthProvider, linkWithCredential } from 'firebase/auth';\nconst firebaseConfig = {\n  apiKey: process.env.REACT_APP_FIREBASE_API_KEY,\n  authDomain: process.env.REACT_APP_FIREBASE_AUTH_DOMAIN,\n  projectId: process.env.REACT_APP_FIREBASE_PROJECT_ID,\n  storageBucket: process.env.REACT_APP_FIREBASE_STORAGE_BUCKET,\n  messagingSenderId: process.env.REACT_APP_FIREBASE_MESSAGING_SENDER_ID,\n  appId: process.env.REACT_APP_FIREBASE_APP_ID,\n  measurementId: process.env.REACT_APP_FIREBASE_MEASUREMENT_ID\n};\nlet messagingInstance;\nlet analyticsInstance;\nlet firestoreInstance;\nlet authInstance;\nlet firebaseApp;\nexport function initFirebase() {\n  firebaseApp = initializeApp(firebaseConfig);\n  try {\n    messagingInstance = getMessaging(firebaseApp);\n  } catch (e) {\n    console.warn('Messaging not available', e);\n  }\n  // Initialize Firestore\n  try {\n    firestoreInstance = getFirestore(firebaseApp);\n    console.log('Firestore initialized');\n  } catch (e) {\n    console.warn('Firestore not available', e);\n  }\n  // Initialize Auth\n  try {\n    authInstance = getAuth(firebaseApp);\n    console.log('Auth initialized');\n  } catch (e) {\n    console.warn('Auth not available', e);\n  }\n  return firebaseApp;\n}\n\n// Get Auth instance\nexport function getAuthInstance() {\n  if (!authInstance && firebaseApp) {\n    authInstance = getAuth(firebaseApp);\n  }\n  return authInstance;\n}\n\n// Get Firestore instance\nexport function getDb() {\n  if (!firestoreInstance && firebaseApp) {\n    firestoreInstance = getFirestore(firebaseApp);\n  }\n  return firestoreInstance;\n}\n\n// ===========================\n// AUTHENTICATION FUNCTIONS\n// ===========================\n\n// Sign up with email and password\nexport async function signUpWithEmail(email, password, displayName) {\n  const auth = getAuthInstance();\n  if (!auth) throw new Error('Auth not initialized');\n  const userCredential = await createUserWithEmailAndPassword(auth, email, password);\n\n  // Update display name\n  if (displayName) {\n    await updateProfile(userCredential.user, {\n      displayName\n    });\n  }\n  return userCredential.user;\n}\n\n// Sign in with email and password\nexport async function signInWithEmail(email, password) {\n  const auth = getAuthInstance();\n  if (!auth) throw new Error('Auth not initialized');\n  const userCredential = await signInWithEmailAndPassword(auth, email, password);\n  return userCredential.user;\n}\n\n// Sign in with Google\nexport async function signInWithGoogle() {\n  const auth = getAuthInstance();\n  if (!auth) throw new Error('Auth not initialized');\n  const provider = new GoogleAuthProvider();\n  const userCredential = await signInWithPopup(auth, provider);\n  return userCredential.user;\n}\n\n// Sign out\nexport async function signOut() {\n  const auth = getAuthInstance();\n  if (!auth) throw new Error('Auth not initialized');\n  await firebaseSignOut(auth);\n}\n\n// Listen to auth state changes\nexport function subscribeToAuthState(callback) {\n  const auth = getAuthInstance();\n  if (!auth) {\n    console.warn('Auth not initialized');\n    return () => {};\n  }\n  return onAuthStateChanged(auth, callback);\n}\n\n// Send password reset email\nexport async function resetPassword(email) {\n  const auth = getAuthInstance();\n  if (!auth) throw new Error('Auth not initialized');\n  await sendPasswordResetEmail(auth, email);\n}\n\n// ===========================\n// PHONE AUTHENTICATION\n// ===========================\n\n// Store reCAPTCHA verifier instance\nlet recaptchaVerifier = null;\nlet confirmationResult = null;\n\n// Initialize reCAPTCHA verifier for phone auth\nexport function initRecaptcha(buttonId) {\n  const auth = getAuthInstance();\n  if (!auth) throw new Error('Auth not initialized');\n\n  // Clear any existing verifier\n  if (recaptchaVerifier) {\n    try {\n      recaptchaVerifier.clear();\n    } catch (e) {\n      console.warn('Could not clear recaptcha:', e);\n    }\n  }\n  recaptchaVerifier = new RecaptchaVerifier(auth, buttonId, {\n    size: 'invisible',\n    callback: () => {\n      console.log('reCAPTCHA verified');\n    },\n    'expired-callback': () => {\n      console.log('reCAPTCHA expired');\n    }\n  });\n  return recaptchaVerifier;\n}\n\n// Send OTP to phone number\nexport async function sendPhoneOTP(phoneNumber) {\n  const auth = getAuthInstance();\n  if (!auth) throw new Error('Auth not initialized');\n  if (!recaptchaVerifier) {\n    throw new Error('reCAPTCHA not initialized. Call initRecaptcha first.');\n  }\n\n  // Format phone number for South Africa if not already formatted\n  let formattedNumber = phoneNumber.trim();\n  if (formattedNumber.startsWith('0')) {\n    formattedNumber = '+27' + formattedNumber.slice(1);\n  } else if (!formattedNumber.startsWith('+')) {\n    formattedNumber = '+27' + formattedNumber;\n  }\n  try {\n    confirmationResult = await signInWithPhoneNumber(auth, formattedNumber, recaptchaVerifier);\n    console.log('OTP sent successfully');\n    return {\n      success: true,\n      formattedNumber\n    };\n  } catch (error) {\n    console.error('Error sending OTP:', error);\n    // Reset reCAPTCHA on error\n    if (recaptchaVerifier) {\n      try {\n        recaptchaVerifier.clear();\n        recaptchaVerifier = null;\n      } catch (e) {}\n    }\n    throw error;\n  }\n}\n\n// Verify OTP code\nexport async function verifyPhoneOTP(otpCode) {\n  if (!confirmationResult) {\n    throw new Error('No OTP request pending. Send OTP first.');\n  }\n  try {\n    const userCredential = await confirmationResult.confirm(otpCode);\n    confirmationResult = null; // Clear after successful verification\n    return userCredential.user;\n  } catch (error) {\n    console.error('Error verifying OTP:', error);\n    throw error;\n  }\n}\n\n// Link phone number to existing account\nexport async function linkPhoneToAccount(otpCode) {\n  const auth = getAuthInstance();\n  if (!auth || !auth.currentUser) throw new Error('No user logged in');\n  if (!confirmationResult) throw new Error('No OTP request pending');\n  try {\n    const credential = PhoneAuthProvider.credential(confirmationResult.verificationId, otpCode);\n    await linkWithCredential(auth.currentUser, credential);\n    confirmationResult = null;\n    return true;\n  } catch (error) {\n    console.error('Error linking phone:', error);\n    throw error;\n  }\n}\n\n// Clear reCAPTCHA (useful for cleanup)\nexport function clearRecaptcha() {\n  if (recaptchaVerifier) {\n    try {\n      recaptchaVerifier.clear();\n    } catch (e) {}\n    recaptchaVerifier = null;\n  }\n  confirmationResult = null;\n}\n\n// Get current user\nexport function getCurrentUser() {\n  const auth = getAuthInstance();\n  return (auth === null || auth === void 0 ? void 0 : auth.currentUser) || null;\n}\n\n// ===========================\n// USER PROFILE FUNCTIONS\n// ===========================\n\n// Get user profile from Firestore\nexport async function getUserProfile(userId) {\n  const db = getDb();\n  if (!db) return null;\n  try {\n    const userRef = doc(db, 'users', userId);\n    const snapshot = await getDoc(userRef);\n    if (snapshot.exists()) {\n      return {\n        id: snapshot.id,\n        ...snapshot.data()\n      };\n    }\n    return null;\n  } catch (error) {\n    console.error('Error fetching user profile:', error);\n    return null;\n  }\n}\n\n// Create or update user profile in Firestore\nexport async function saveUserProfile(userId, profileData) {\n  const db = getDb();\n  if (!db) throw new Error('Firestore not initialized');\n  try {\n    const userRef = doc(db, 'users', userId);\n    await setDoc(userRef, {\n      ...profileData,\n      updatedAt: serverTimestamp()\n    }, {\n      merge: true\n    });\n    console.log('User profile saved:', userId);\n    return true;\n  } catch (error) {\n    console.error('Error saving user profile:', error);\n    throw error;\n  }\n}\n\n// ===========================\n// LISTINGS FIRESTORE FUNCTIONS\n// ===========================\n\n// Fetch all listings from Firestore\nexport async function fetchListings() {\n  const db = getDb();\n  if (!db) {\n    console.warn('Firestore not initialized, using localStorage');\n    return null; // Fall back to localStorage\n  }\n  try {\n    const listingsRef = collection(db, 'listings');\n    const q = query(listingsRef, orderBy('createdAt', 'desc'));\n    const snapshot = await getDocs(q);\n    const listings = snapshot.docs.map(doc => {\n      var _doc$data$createdAt, _doc$data$createdAt$t, _doc$data$createdAt$t2, _doc$data$availableDa, _doc$data$availableDa2, _doc$data$availableDa3;\n      return {\n        id: doc.id,\n        ...doc.data(),\n        // Convert Firestore timestamps to ISO strings\n        createdAt: ((_doc$data$createdAt = doc.data().createdAt) === null || _doc$data$createdAt === void 0 ? void 0 : (_doc$data$createdAt$t = _doc$data$createdAt.toDate) === null || _doc$data$createdAt$t === void 0 ? void 0 : (_doc$data$createdAt$t2 = _doc$data$createdAt$t.call(_doc$data$createdAt)) === null || _doc$data$createdAt$t2 === void 0 ? void 0 : _doc$data$createdAt$t2.toISOString()) || doc.data().createdAt,\n        availableDate: ((_doc$data$availableDa = doc.data().availableDate) === null || _doc$data$availableDa === void 0 ? void 0 : (_doc$data$availableDa2 = _doc$data$availableDa.toDate) === null || _doc$data$availableDa2 === void 0 ? void 0 : (_doc$data$availableDa3 = _doc$data$availableDa2.call(_doc$data$availableDa)) === null || _doc$data$availableDa3 === void 0 ? void 0 : _doc$data$availableDa3.toISOString()) || doc.data().availableDate\n      };\n    });\n    console.log(`Fetched ${listings.length} listings from Firestore`);\n    return listings;\n  } catch (error) {\n    console.error('Error fetching listings from Firestore:', error);\n    return null; // Fall back to localStorage\n  }\n}\n\n// Add a new listing to Firestore\nexport async function addListing(listingData) {\n  const db = getDb();\n  if (!db) {\n    console.warn('Firestore not initialized');\n    return null;\n  }\n  try {\n    const listingsRef = collection(db, 'listings');\n    const docRef = await addDoc(listingsRef, {\n      ...listingData,\n      createdAt: serverTimestamp(),\n      status: 'available'\n    });\n    console.log('Listing added with ID:', docRef.id);\n    return docRef.id;\n  } catch (error) {\n    console.error('Error adding listing to Firestore:', error);\n    throw error;\n  }\n}\n\n// Update an existing listing\nexport async function updateListing(listingId, updates) {\n  const db = getDb();\n  if (!db) {\n    console.warn('Firestore not initialized');\n    return false;\n  }\n  try {\n    const listingRef = doc(db, 'listings', listingId);\n    await updateDoc(listingRef, {\n      ...updates,\n      updatedAt: serverTimestamp()\n    });\n    console.log('Listing updated:', listingId);\n    return true;\n  } catch (error) {\n    console.error('Error updating listing in Firestore:', error);\n    throw error;\n  }\n}\n\n// Delete a listing\nexport async function deleteListing(listingId) {\n  const db = getDb();\n  if (!db) {\n    console.warn('Firestore not initialized');\n    return false;\n  }\n  try {\n    const listingRef = doc(db, 'listings', listingId);\n    await deleteDoc(listingRef);\n    console.log('Listing deleted:', listingId);\n    return true;\n  } catch (error) {\n    console.error('Error deleting listing from Firestore:', error);\n    throw error;\n  }\n}\n\n// Get listings by landlord ID\nexport async function fetchListingsByLandlord(landlordId) {\n  const db = getDb();\n  if (!db) return null;\n  try {\n    const listingsRef = collection(db, 'listings');\n    const q = query(listingsRef, where('landlordId', '==', landlordId));\n    const snapshot = await getDocs(q);\n    return snapshot.docs.map(doc => {\n      var _doc$data$createdAt2, _doc$data$createdAt2$, _doc$data$createdAt2$2, _doc$data$availableDa4, _doc$data$availableDa5, _doc$data$availableDa6;\n      return {\n        id: doc.id,\n        ...doc.data(),\n        createdAt: ((_doc$data$createdAt2 = doc.data().createdAt) === null || _doc$data$createdAt2 === void 0 ? void 0 : (_doc$data$createdAt2$ = _doc$data$createdAt2.toDate) === null || _doc$data$createdAt2$ === void 0 ? void 0 : (_doc$data$createdAt2$2 = _doc$data$createdAt2$.call(_doc$data$createdAt2)) === null || _doc$data$createdAt2$2 === void 0 ? void 0 : _doc$data$createdAt2$2.toISOString()) || doc.data().createdAt,\n        availableDate: ((_doc$data$availableDa4 = doc.data().availableDate) === null || _doc$data$availableDa4 === void 0 ? void 0 : (_doc$data$availableDa5 = _doc$data$availableDa4.toDate) === null || _doc$data$availableDa5 === void 0 ? void 0 : (_doc$data$availableDa6 = _doc$data$availableDa5.call(_doc$data$availableDa4)) === null || _doc$data$availableDa6 === void 0 ? void 0 : _doc$data$availableDa6.toISOString()) || doc.data().availableDate\n      };\n    });\n  } catch (error) {\n    console.error('Error fetching landlord listings:', error);\n    return null;\n  }\n}\n\n// Subscribe to real-time listing updates\nexport function subscribeToListings(callback) {\n  const db = getDb();\n  if (!db) {\n    console.warn('Firestore not initialized for real-time updates');\n    return null;\n  }\n  try {\n    const listingsRef = collection(db, 'listings');\n    const q = query(listingsRef, orderBy('createdAt', 'desc'));\n    const unsubscribe = onSnapshot(q, snapshot => {\n      const listings = snapshot.docs.map(doc => {\n        var _doc$data$createdAt3, _doc$data$createdAt3$, _doc$data$createdAt3$2, _doc$data$availableDa7, _doc$data$availableDa8, _doc$data$availableDa9;\n        return {\n          id: doc.id,\n          ...doc.data(),\n          createdAt: ((_doc$data$createdAt3 = doc.data().createdAt) === null || _doc$data$createdAt3 === void 0 ? void 0 : (_doc$data$createdAt3$ = _doc$data$createdAt3.toDate) === null || _doc$data$createdAt3$ === void 0 ? void 0 : (_doc$data$createdAt3$2 = _doc$data$createdAt3$.call(_doc$data$createdAt3)) === null || _doc$data$createdAt3$2 === void 0 ? void 0 : _doc$data$createdAt3$2.toISOString()) || doc.data().createdAt,\n          availableDate: ((_doc$data$availableDa7 = doc.data().availableDate) === null || _doc$data$availableDa7 === void 0 ? void 0 : (_doc$data$availableDa8 = _doc$data$availableDa7.toDate) === null || _doc$data$availableDa8 === void 0 ? void 0 : (_doc$data$availableDa9 = _doc$data$availableDa8.call(_doc$data$availableDa7)) === null || _doc$data$availableDa9 === void 0 ? void 0 : _doc$data$availableDa9.toISOString()) || doc.data().availableDate\n        };\n      });\n      console.log(`Real-time update: ${listings.length} listings`);\n      callback(listings);\n    }, error => {\n      console.error('Real-time listener error:', error);\n    });\n    return unsubscribe;\n  } catch (error) {\n    console.error('Error setting up real-time listener:', error);\n    return null;\n  }\n}\n\n// Check if Firestore is available and configured\nexport function isFirestoreEnabled() {\n  return !!process.env.REACT_APP_FIREBASE_PROJECT_ID && !!getDb();\n}\nexport function initAnalytics(app) {\n  if (process.env.REACT_APP_ENABLE_ANALYTICS !== 'true') return;\n  const consent = localStorage.getItem('analytics-consent');\n  if (consent !== 'yes') return;\n  try {\n    analyticsInstance = getAnalytics(app);\n    console.log('Analytics initialized');\n  } catch (e) {\n    console.warn('Analytics not available', e);\n  }\n}\nexport function trackEvent(eventName, params = {}) {\n  if (!analyticsInstance) return;\n  try {\n    logEvent(analyticsInstance, eventName, params);\n  } catch (e) {\n    console.warn('Event tracking failed', e);\n  }\n}\n\n// Request notification permission and fetch token\nexport async function requestFcmToken() {\n  if (!messagingInstance) return null;\n  const permission = await Notification.requestPermission();\n  if (permission !== 'granted') {\n    console.log('Notification permission denied');\n    return null;\n  }\n  try {\n    const vapidKey = process.env.REACT_APP_FIREBASE_VAPID_KEY; // Public VAPID key\n    const currentToken = await getToken(messagingInstance, {\n      vapidKey\n    });\n    if (currentToken) {\n      console.log('FCM token:', currentToken);\n      // Persist token to backend if configured\n      try {\n        const backend = process.env.REACT_APP_BACKEND_URL;\n        if (backend) {\n          await fetch(`${backend.replace(/\\/$/, '')}/api/push/register`, {\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n              token: currentToken\n            })\n          });\n        }\n      } catch (e) {\n        console.warn('Token persistence failed', e);\n      }\n      return currentToken;\n    } else {\n      console.log('No registration token available.');\n      return null;\n    }\n  } catch (err) {\n    console.error('An error occurred while retrieving token.', err);\n    return null;\n  }\n}\nexport function listenForegroundMessages(callback) {\n  if (!messagingInstance) return;\n  onMessage(messagingInstance, payload => {\n    console.log('Foreground message received', payload);\n    if (callback) callback(payload);\n  });\n}","map":{"version":3,"names":["initializeApp","getMessaging","getToken","onMessage","getAnalytics","logEvent","getFirestore","collection","doc","getDocs","getDoc","setDoc","addDoc","updateDoc","deleteDoc","query","where","orderBy","onSnapshot","serverTimestamp","getAuth","createUserWithEmailAndPassword","signInWithEmailAndPassword","signInWithPopup","GoogleAuthProvider","signOut","firebaseSignOut","onAuthStateChanged","updateProfile","sendPasswordResetEmail","RecaptchaVerifier","signInWithPhoneNumber","PhoneAuthProvider","linkWithCredential","firebaseConfig","apiKey","process","env","REACT_APP_FIREBASE_API_KEY","authDomain","REACT_APP_FIREBASE_AUTH_DOMAIN","projectId","REACT_APP_FIREBASE_PROJECT_ID","storageBucket","REACT_APP_FIREBASE_STORAGE_BUCKET","messagingSenderId","REACT_APP_FIREBASE_MESSAGING_SENDER_ID","appId","REACT_APP_FIREBASE_APP_ID","measurementId","REACT_APP_FIREBASE_MEASUREMENT_ID","messagingInstance","analyticsInstance","firestoreInstance","authInstance","firebaseApp","initFirebase","e","console","warn","log","getAuthInstance","getDb","signUpWithEmail","email","password","displayName","auth","Error","userCredential","user","signInWithEmail","signInWithGoogle","provider","subscribeToAuthState","callback","resetPassword","recaptchaVerifier","confirmationResult","initRecaptcha","buttonId","clear","size","expired-callback","sendPhoneOTP","phoneNumber","formattedNumber","trim","startsWith","slice","success","error","verifyPhoneOTP","otpCode","confirm","linkPhoneToAccount","currentUser","credential","verificationId","clearRecaptcha","getCurrentUser","getUserProfile","userId","db","userRef","snapshot","exists","id","data","saveUserProfile","profileData","updatedAt","merge","fetchListings","listingsRef","q","listings","docs","map","_doc$data$createdAt","_doc$data$createdAt$t","_doc$data$createdAt$t2","_doc$data$availableDa","_doc$data$availableDa2","_doc$data$availableDa3","createdAt","toDate","call","toISOString","availableDate","length","addListing","listingData","docRef","status","updateListing","listingId","updates","listingRef","deleteListing","fetchListingsByLandlord","landlordId","_doc$data$createdAt2","_doc$data$createdAt2$","_doc$data$createdAt2$2","_doc$data$availableDa4","_doc$data$availableDa5","_doc$data$availableDa6","subscribeToListings","unsubscribe","_doc$data$createdAt3","_doc$data$createdAt3$","_doc$data$createdAt3$2","_doc$data$availableDa7","_doc$data$availableDa8","_doc$data$availableDa9","isFirestoreEnabled","initAnalytics","app","REACT_APP_ENABLE_ANALYTICS","consent","localStorage","getItem","trackEvent","eventName","params","requestFcmToken","permission","Notification","requestPermission","vapidKey","REACT_APP_FIREBASE_VAPID_KEY","currentToken","backend","REACT_APP_BACKEND_URL","fetch","replace","method","headers","body","JSON","stringify","token","err","listenForegroundMessages","payload"],"sources":["C:/Users/kutum/Documents/room-rental-platform/src/firebase.js"],"sourcesContent":["// Firebase client initialization for Room24\r\n// Replace placeholder environment variables with real Firebase project config.\r\n// Ensure you have added a web app in Firebase console and enabled Cloud Messaging.\r\n\r\nimport { initializeApp } from 'firebase/app';\r\nimport { getMessaging, getToken, onMessage } from 'firebase/messaging';\r\nimport { getAnalytics, logEvent } from 'firebase/analytics';\r\nimport { \r\n  getFirestore, \r\n  collection, \r\n  doc, \r\n  getDocs, \r\n  getDoc,\r\n  setDoc,\r\n  addDoc, \r\n  updateDoc, \r\n  deleteDoc, \r\n  query, \r\n  where, \r\n  orderBy,\r\n  onSnapshot,\r\n  serverTimestamp \r\n} from 'firebase/firestore';\r\nimport {\r\n  getAuth,\r\n  createUserWithEmailAndPassword,\r\n  signInWithEmailAndPassword,\r\n  signInWithPopup,\r\n  GoogleAuthProvider,\r\n  signOut as firebaseSignOut,\r\n  onAuthStateChanged,\r\n  updateProfile,\r\n  sendPasswordResetEmail,\r\n  RecaptchaVerifier,\r\n  signInWithPhoneNumber,\r\n  PhoneAuthProvider,\r\n  linkWithCredential\r\n} from 'firebase/auth';\r\n\r\nconst firebaseConfig = {\r\n  apiKey: process.env.REACT_APP_FIREBASE_API_KEY,\r\n  authDomain: process.env.REACT_APP_FIREBASE_AUTH_DOMAIN,\r\n  projectId: process.env.REACT_APP_FIREBASE_PROJECT_ID,\r\n  storageBucket: process.env.REACT_APP_FIREBASE_STORAGE_BUCKET,\r\n  messagingSenderId: process.env.REACT_APP_FIREBASE_MESSAGING_SENDER_ID,\r\n  appId: process.env.REACT_APP_FIREBASE_APP_ID,\r\n  measurementId: process.env.REACT_APP_FIREBASE_MEASUREMENT_ID,\r\n};\r\n\r\nlet messagingInstance;\r\nlet analyticsInstance;\r\nlet firestoreInstance;\r\nlet authInstance;\r\nlet firebaseApp;\r\n\r\nexport function initFirebase() {\r\n  firebaseApp = initializeApp(firebaseConfig);\r\n  try {\r\n    messagingInstance = getMessaging(firebaseApp);\r\n  } catch (e) {\r\n    console.warn('Messaging not available', e);\r\n  }\r\n  // Initialize Firestore\r\n  try {\r\n    firestoreInstance = getFirestore(firebaseApp);\r\n    console.log('Firestore initialized');\r\n  } catch (e) {\r\n    console.warn('Firestore not available', e);\r\n  }\r\n  // Initialize Auth\r\n  try {\r\n    authInstance = getAuth(firebaseApp);\r\n    console.log('Auth initialized');\r\n  } catch (e) {\r\n    console.warn('Auth not available', e);\r\n  }\r\n  return firebaseApp;\r\n}\r\n\r\n// Get Auth instance\r\nexport function getAuthInstance() {\r\n  if (!authInstance && firebaseApp) {\r\n    authInstance = getAuth(firebaseApp);\r\n  }\r\n  return authInstance;\r\n}\r\n\r\n// Get Firestore instance\r\nexport function getDb() {\r\n  if (!firestoreInstance && firebaseApp) {\r\n    firestoreInstance = getFirestore(firebaseApp);\r\n  }\r\n  return firestoreInstance;\r\n}\r\n\r\n// ===========================\r\n// AUTHENTICATION FUNCTIONS\r\n// ===========================\r\n\r\n// Sign up with email and password\r\nexport async function signUpWithEmail(email, password, displayName) {\r\n  const auth = getAuthInstance();\r\n  if (!auth) throw new Error('Auth not initialized');\r\n  \r\n  const userCredential = await createUserWithEmailAndPassword(auth, email, password);\r\n  \r\n  // Update display name\r\n  if (displayName) {\r\n    await updateProfile(userCredential.user, { displayName });\r\n  }\r\n  \r\n  return userCredential.user;\r\n}\r\n\r\n// Sign in with email and password\r\nexport async function signInWithEmail(email, password) {\r\n  const auth = getAuthInstance();\r\n  if (!auth) throw new Error('Auth not initialized');\r\n  \r\n  const userCredential = await signInWithEmailAndPassword(auth, email, password);\r\n  return userCredential.user;\r\n}\r\n\r\n// Sign in with Google\r\nexport async function signInWithGoogle() {\r\n  const auth = getAuthInstance();\r\n  if (!auth) throw new Error('Auth not initialized');\r\n  \r\n  const provider = new GoogleAuthProvider();\r\n  const userCredential = await signInWithPopup(auth, provider);\r\n  return userCredential.user;\r\n}\r\n\r\n// Sign out\r\nexport async function signOut() {\r\n  const auth = getAuthInstance();\r\n  if (!auth) throw new Error('Auth not initialized');\r\n  \r\n  await firebaseSignOut(auth);\r\n}\r\n\r\n// Listen to auth state changes\r\nexport function subscribeToAuthState(callback) {\r\n  const auth = getAuthInstance();\r\n  if (!auth) {\r\n    console.warn('Auth not initialized');\r\n    return () => {};\r\n  }\r\n  \r\n  return onAuthStateChanged(auth, callback);\r\n}\r\n\r\n// Send password reset email\r\nexport async function resetPassword(email) {\r\n  const auth = getAuthInstance();\r\n  if (!auth) throw new Error('Auth not initialized');\r\n  \r\n  await sendPasswordResetEmail(auth, email);\r\n}\r\n\r\n// ===========================\r\n// PHONE AUTHENTICATION\r\n// ===========================\r\n\r\n// Store reCAPTCHA verifier instance\r\nlet recaptchaVerifier = null;\r\nlet confirmationResult = null;\r\n\r\n// Initialize reCAPTCHA verifier for phone auth\r\nexport function initRecaptcha(buttonId) {\r\n  const auth = getAuthInstance();\r\n  if (!auth) throw new Error('Auth not initialized');\r\n  \r\n  // Clear any existing verifier\r\n  if (recaptchaVerifier) {\r\n    try {\r\n      recaptchaVerifier.clear();\r\n    } catch (e) {\r\n      console.warn('Could not clear recaptcha:', e);\r\n    }\r\n  }\r\n  \r\n  recaptchaVerifier = new RecaptchaVerifier(auth, buttonId, {\r\n    size: 'invisible',\r\n    callback: () => {\r\n      console.log('reCAPTCHA verified');\r\n    },\r\n    'expired-callback': () => {\r\n      console.log('reCAPTCHA expired');\r\n    }\r\n  });\r\n  \r\n  return recaptchaVerifier;\r\n}\r\n\r\n// Send OTP to phone number\r\nexport async function sendPhoneOTP(phoneNumber) {\r\n  const auth = getAuthInstance();\r\n  if (!auth) throw new Error('Auth not initialized');\r\n  \r\n  if (!recaptchaVerifier) {\r\n    throw new Error('reCAPTCHA not initialized. Call initRecaptcha first.');\r\n  }\r\n  \r\n  // Format phone number for South Africa if not already formatted\r\n  let formattedNumber = phoneNumber.trim();\r\n  if (formattedNumber.startsWith('0')) {\r\n    formattedNumber = '+27' + formattedNumber.slice(1);\r\n  } else if (!formattedNumber.startsWith('+')) {\r\n    formattedNumber = '+27' + formattedNumber;\r\n  }\r\n  \r\n  try {\r\n    confirmationResult = await signInWithPhoneNumber(auth, formattedNumber, recaptchaVerifier);\r\n    console.log('OTP sent successfully');\r\n    return { success: true, formattedNumber };\r\n  } catch (error) {\r\n    console.error('Error sending OTP:', error);\r\n    // Reset reCAPTCHA on error\r\n    if (recaptchaVerifier) {\r\n      try {\r\n        recaptchaVerifier.clear();\r\n        recaptchaVerifier = null;\r\n      } catch (e) {}\r\n    }\r\n    throw error;\r\n  }\r\n}\r\n\r\n// Verify OTP code\r\nexport async function verifyPhoneOTP(otpCode) {\r\n  if (!confirmationResult) {\r\n    throw new Error('No OTP request pending. Send OTP first.');\r\n  }\r\n  \r\n  try {\r\n    const userCredential = await confirmationResult.confirm(otpCode);\r\n    confirmationResult = null; // Clear after successful verification\r\n    return userCredential.user;\r\n  } catch (error) {\r\n    console.error('Error verifying OTP:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n// Link phone number to existing account\r\nexport async function linkPhoneToAccount(otpCode) {\r\n  const auth = getAuthInstance();\r\n  if (!auth || !auth.currentUser) throw new Error('No user logged in');\r\n  if (!confirmationResult) throw new Error('No OTP request pending');\r\n  \r\n  try {\r\n    const credential = PhoneAuthProvider.credential(\r\n      confirmationResult.verificationId,\r\n      otpCode\r\n    );\r\n    await linkWithCredential(auth.currentUser, credential);\r\n    confirmationResult = null;\r\n    return true;\r\n  } catch (error) {\r\n    console.error('Error linking phone:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n// Clear reCAPTCHA (useful for cleanup)\r\nexport function clearRecaptcha() {\r\n  if (recaptchaVerifier) {\r\n    try {\r\n      recaptchaVerifier.clear();\r\n    } catch (e) {}\r\n    recaptchaVerifier = null;\r\n  }\r\n  confirmationResult = null;\r\n}\r\n\r\n// Get current user\r\nexport function getCurrentUser() {\r\n  const auth = getAuthInstance();\r\n  return auth?.currentUser || null;\r\n}\r\n\r\n// ===========================\r\n// USER PROFILE FUNCTIONS\r\n// ===========================\r\n\r\n// Get user profile from Firestore\r\nexport async function getUserProfile(userId) {\r\n  const db = getDb();\r\n  if (!db) return null;\r\n  \r\n  try {\r\n    const userRef = doc(db, 'users', userId);\r\n    const snapshot = await getDoc(userRef);\r\n    if (snapshot.exists()) {\r\n      return { id: snapshot.id, ...snapshot.data() };\r\n    }\r\n    return null;\r\n  } catch (error) {\r\n    console.error('Error fetching user profile:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n// Create or update user profile in Firestore\r\nexport async function saveUserProfile(userId, profileData) {\r\n  const db = getDb();\r\n  if (!db) throw new Error('Firestore not initialized');\r\n  \r\n  try {\r\n    const userRef = doc(db, 'users', userId);\r\n    await setDoc(userRef, {\r\n      ...profileData,\r\n      updatedAt: serverTimestamp(),\r\n    }, { merge: true });\r\n    console.log('User profile saved:', userId);\r\n    return true;\r\n  } catch (error) {\r\n    console.error('Error saving user profile:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n// ===========================\r\n// LISTINGS FIRESTORE FUNCTIONS\r\n// ===========================\r\n\r\n// Fetch all listings from Firestore\r\nexport async function fetchListings() {\r\n  const db = getDb();\r\n  if (!db) {\r\n    console.warn('Firestore not initialized, using localStorage');\r\n    return null; // Fall back to localStorage\r\n  }\r\n  try {\r\n    const listingsRef = collection(db, 'listings');\r\n    const q = query(listingsRef, orderBy('createdAt', 'desc'));\r\n    const snapshot = await getDocs(q);\r\n    const listings = snapshot.docs.map(doc => ({\r\n      id: doc.id,\r\n      ...doc.data(),\r\n      // Convert Firestore timestamps to ISO strings\r\n      createdAt: doc.data().createdAt?.toDate?.()?.toISOString() || doc.data().createdAt,\r\n      availableDate: doc.data().availableDate?.toDate?.()?.toISOString() || doc.data().availableDate,\r\n    }));\r\n    console.log(`Fetched ${listings.length} listings from Firestore`);\r\n    return listings;\r\n  } catch (error) {\r\n    console.error('Error fetching listings from Firestore:', error);\r\n    return null; // Fall back to localStorage\r\n  }\r\n}\r\n\r\n// Add a new listing to Firestore\r\nexport async function addListing(listingData) {\r\n  const db = getDb();\r\n  if (!db) {\r\n    console.warn('Firestore not initialized');\r\n    return null;\r\n  }\r\n  try {\r\n    const listingsRef = collection(db, 'listings');\r\n    const docRef = await addDoc(listingsRef, {\r\n      ...listingData,\r\n      createdAt: serverTimestamp(),\r\n      status: 'available',\r\n    });\r\n    console.log('Listing added with ID:', docRef.id);\r\n    return docRef.id;\r\n  } catch (error) {\r\n    console.error('Error adding listing to Firestore:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n// Update an existing listing\r\nexport async function updateListing(listingId, updates) {\r\n  const db = getDb();\r\n  if (!db) {\r\n    console.warn('Firestore not initialized');\r\n    return false;\r\n  }\r\n  try {\r\n    const listingRef = doc(db, 'listings', listingId);\r\n    await updateDoc(listingRef, {\r\n      ...updates,\r\n      updatedAt: serverTimestamp(),\r\n    });\r\n    console.log('Listing updated:', listingId);\r\n    return true;\r\n  } catch (error) {\r\n    console.error('Error updating listing in Firestore:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n// Delete a listing\r\nexport async function deleteListing(listingId) {\r\n  const db = getDb();\r\n  if (!db) {\r\n    console.warn('Firestore not initialized');\r\n    return false;\r\n  }\r\n  try {\r\n    const listingRef = doc(db, 'listings', listingId);\r\n    await deleteDoc(listingRef);\r\n    console.log('Listing deleted:', listingId);\r\n    return true;\r\n  } catch (error) {\r\n    console.error('Error deleting listing from Firestore:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n// Get listings by landlord ID\r\nexport async function fetchListingsByLandlord(landlordId) {\r\n  const db = getDb();\r\n  if (!db) return null;\r\n  try {\r\n    const listingsRef = collection(db, 'listings');\r\n    const q = query(listingsRef, where('landlordId', '==', landlordId));\r\n    const snapshot = await getDocs(q);\r\n    return snapshot.docs.map(doc => ({\r\n      id: doc.id,\r\n      ...doc.data(),\r\n      createdAt: doc.data().createdAt?.toDate?.()?.toISOString() || doc.data().createdAt,\r\n      availableDate: doc.data().availableDate?.toDate?.()?.toISOString() || doc.data().availableDate,\r\n    }));\r\n  } catch (error) {\r\n    console.error('Error fetching landlord listings:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n// Subscribe to real-time listing updates\r\nexport function subscribeToListings(callback) {\r\n  const db = getDb();\r\n  if (!db) {\r\n    console.warn('Firestore not initialized for real-time updates');\r\n    return null;\r\n  }\r\n  try {\r\n    const listingsRef = collection(db, 'listings');\r\n    const q = query(listingsRef, orderBy('createdAt', 'desc'));\r\n    \r\n    const unsubscribe = onSnapshot(q, (snapshot) => {\r\n      const listings = snapshot.docs.map(doc => ({\r\n        id: doc.id,\r\n        ...doc.data(),\r\n        createdAt: doc.data().createdAt?.toDate?.()?.toISOString() || doc.data().createdAt,\r\n        availableDate: doc.data().availableDate?.toDate?.()?.toISOString() || doc.data().availableDate,\r\n      }));\r\n      console.log(`Real-time update: ${listings.length} listings`);\r\n      callback(listings);\r\n    }, (error) => {\r\n      console.error('Real-time listener error:', error);\r\n    });\r\n    \r\n    return unsubscribe;\r\n  } catch (error) {\r\n    console.error('Error setting up real-time listener:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n// Check if Firestore is available and configured\r\nexport function isFirestoreEnabled() {\r\n  return !!process.env.REACT_APP_FIREBASE_PROJECT_ID && !!getDb();\r\n}\r\n\r\nexport function initAnalytics(app) {\r\n  if (process.env.REACT_APP_ENABLE_ANALYTICS !== 'true') return;\r\n  const consent = localStorage.getItem('analytics-consent');\r\n  if (consent !== 'yes') return;\r\n  try {\r\n    analyticsInstance = getAnalytics(app);\r\n    console.log('Analytics initialized');\r\n  } catch (e) {\r\n    console.warn('Analytics not available', e);\r\n  }\r\n}\r\n\r\nexport function trackEvent(eventName, params = {}) {\r\n  if (!analyticsInstance) return;\r\n  try {\r\n    logEvent(analyticsInstance, eventName, params);\r\n  } catch (e) {\r\n    console.warn('Event tracking failed', e);\r\n  }\r\n}\r\n\r\n// Request notification permission and fetch token\r\nexport async function requestFcmToken() {\r\n  if (!messagingInstance) return null;\r\n  const permission = await Notification.requestPermission();\r\n  if (permission !== 'granted') {\r\n    console.log('Notification permission denied');\r\n    return null;\r\n  }\r\n  try {\r\n    const vapidKey = process.env.REACT_APP_FIREBASE_VAPID_KEY; // Public VAPID key\r\n    const currentToken = await getToken(messagingInstance, { vapidKey });\r\n    if (currentToken) {\r\n      console.log('FCM token:', currentToken);\r\n      // Persist token to backend if configured\r\n      try {\r\n        const backend = process.env.REACT_APP_BACKEND_URL;\r\n        if (backend) {\r\n          await fetch(`${backend.replace(/\\/$/, '')}/api/push/register`, {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({ token: currentToken })\r\n          });\r\n        }\r\n      } catch (e) {\r\n        console.warn('Token persistence failed', e);\r\n      }\r\n      return currentToken;\r\n    } else {\r\n      console.log('No registration token available.');\r\n      return null;\r\n    }\r\n  } catch (err) {\r\n    console.error('An error occurred while retrieving token.', err);\r\n    return null;\r\n  }\r\n}\r\n\r\nexport function listenForegroundMessages(callback) {\r\n  if (!messagingInstance) return;\r\n  onMessage(messagingInstance, payload => {\r\n    console.log('Foreground message received', payload);\r\n    if (callback) callback(payload);\r\n  });\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}