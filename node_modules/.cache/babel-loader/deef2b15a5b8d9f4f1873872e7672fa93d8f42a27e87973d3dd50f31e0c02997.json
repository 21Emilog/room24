{"ast":null,"code":"/**\r\n * Compress and resize image file for optimal upload and storage\r\n * @param {File} file - Original image file\r\n * @param {Object} options - Compression options\r\n * @returns {Promise<string>} - Base64 encoded compressed image\r\n */export function compressImage(file){let options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};const{maxWidth=1200,maxHeight=1200,quality=0.8,maxSizeKB=500}=options;return new Promise((resolve,reject)=>{const reader=new FileReader();reader.readAsDataURL(file);reader.onload=event=>{const img=new Image();img.src=event.target.result;img.onload=()=>{const canvas=document.createElement('canvas');let width=img.width;let height=img.height;// Calculate new dimensions\nif(width>height){if(width>maxWidth){height=height*maxWidth/width;width=maxWidth;}}else{if(height>maxHeight){width=width*maxHeight/height;height=maxHeight;}}canvas.width=width;canvas.height=height;const ctx=canvas.getContext('2d');ctx.drawImage(img,0,0,width,height);// Try compression at specified quality\nlet compressedDataUrl=canvas.toDataURL('image/jpeg',quality);// If still too large, reduce quality further\nlet currentQuality=quality;while(compressedDataUrl.length/1024>maxSizeKB&&currentQuality>0.1){currentQuality-=0.1;compressedDataUrl=canvas.toDataURL('image/jpeg',currentQuality);}resolve(compressedDataUrl);};img.onerror=error=>{reject(new Error('Failed to load image'));};};reader.onerror=error=>{reject(new Error('Failed to read file'));};});}/**\r\n * Get file size in KB from base64 string\r\n */export function getBase64SizeKB(base64String){const stringLength=base64String.length-'data:image/jpeg;base64,'.length;const sizeInBytes=4*Math.ceil(stringLength/3)*0.5624896334383812;return sizeInBytes/1024;}","map":{"version":3,"names":["compressImage","file","options","arguments","length","undefined","maxWidth","maxHeight","quality","maxSizeKB","Promise","resolve","reject","reader","FileReader","readAsDataURL","onload","event","img","Image","src","target","result","canvas","document","createElement","width","height","ctx","getContext","drawImage","compressedDataUrl","toDataURL","currentQuality","onerror","error","Error","getBase64SizeKB","base64String","stringLength","sizeInBytes","Math","ceil"],"sources":["C:/Users/kutum/Documents/room-rental-platform/src/utils/imageCompression.js"],"sourcesContent":["/**\r\n * Compress and resize image file for optimal upload and storage\r\n * @param {File} file - Original image file\r\n * @param {Object} options - Compression options\r\n * @returns {Promise<string>} - Base64 encoded compressed image\r\n */\r\nexport function compressImage(file, options = {}) {\r\n  const {\r\n    maxWidth = 1200,\r\n    maxHeight = 1200,\r\n    quality = 0.8,\r\n    maxSizeKB = 500\r\n  } = options;\r\n\r\n  return new Promise((resolve, reject) => {\r\n    const reader = new FileReader();\r\n    reader.readAsDataURL(file);\r\n    \r\n    reader.onload = (event) => {\r\n      const img = new Image();\r\n      img.src = event.target.result;\r\n      \r\n      img.onload = () => {\r\n        const canvas = document.createElement('canvas');\r\n        let width = img.width;\r\n        let height = img.height;\r\n\r\n        // Calculate new dimensions\r\n        if (width > height) {\r\n          if (width > maxWidth) {\r\n            height = (height * maxWidth) / width;\r\n            width = maxWidth;\r\n          }\r\n        } else {\r\n          if (height > maxHeight) {\r\n            width = (width * maxHeight) / height;\r\n            height = maxHeight;\r\n          }\r\n        }\r\n\r\n        canvas.width = width;\r\n        canvas.height = height;\r\n\r\n        const ctx = canvas.getContext('2d');\r\n        ctx.drawImage(img, 0, 0, width, height);\r\n\r\n        // Try compression at specified quality\r\n        let compressedDataUrl = canvas.toDataURL('image/jpeg', quality);\r\n        \r\n        // If still too large, reduce quality further\r\n        let currentQuality = quality;\r\n        while (compressedDataUrl.length / 1024 > maxSizeKB && currentQuality > 0.1) {\r\n          currentQuality -= 0.1;\r\n          compressedDataUrl = canvas.toDataURL('image/jpeg', currentQuality);\r\n        }\r\n\r\n        resolve(compressedDataUrl);\r\n      };\r\n\r\n      img.onerror = (error) => {\r\n        reject(new Error('Failed to load image'));\r\n      };\r\n    };\r\n\r\n    reader.onerror = (error) => {\r\n      reject(new Error('Failed to read file'));\r\n    };\r\n  });\r\n}\r\n\r\n/**\r\n * Get file size in KB from base64 string\r\n */\r\nexport function getBase64SizeKB(base64String) {\r\n  const stringLength = base64String.length - 'data:image/jpeg;base64,'.length;\r\n  const sizeInBytes = 4 * Math.ceil(stringLength / 3) * 0.5624896334383812;\r\n  return sizeInBytes / 1024;\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}