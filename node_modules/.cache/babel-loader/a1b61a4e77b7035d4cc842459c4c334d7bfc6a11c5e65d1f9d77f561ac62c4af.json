{"ast":null,"code":"// Firebase client initialization for Room24\n// Replace placeholder environment variables with real Firebase project config.\n// Ensure you have added a web app in Firebase console and enabled Cloud Messaging.\n\nimport { initializeApp } from 'firebase/app';\nimport { getMessaging, getToken, onMessage } from 'firebase/messaging';\nimport { getAnalytics, logEvent } from 'firebase/analytics';\nconst firebaseConfig = {\n  apiKey: process.env.REACT_APP_FIREBASE_API_KEY,\n  authDomain: process.env.REACT_APP_FIREBASE_AUTH_DOMAIN,\n  projectId: process.env.REACT_APP_FIREBASE_PROJECT_ID,\n  storageBucket: process.env.REACT_APP_FIREBASE_STORAGE_BUCKET,\n  messagingSenderId: process.env.REACT_APP_FIREBASE_MESSAGING_SENDER_ID,\n  appId: process.env.REACT_APP_FIREBASE_APP_ID,\n  measurementId: process.env.REACT_APP_FIREBASE_MEASUREMENT_ID\n};\nlet messagingInstance;\nlet analyticsInstance;\nexport function initFirebase() {\n  const app = initializeApp(firebaseConfig);\n  try {\n    messagingInstance = getMessaging(app);\n  } catch (e) {\n    console.warn('Messaging not available', e);\n  }\n  return app;\n}\nexport function initAnalytics(app) {\n  if (process.env.REACT_APP_ENABLE_ANALYTICS !== 'true') return;\n  const consent = localStorage.getItem('analytics-consent');\n  if (consent !== 'yes') return;\n  try {\n    analyticsInstance = getAnalytics(app);\n    console.log('Analytics initialized');\n  } catch (e) {\n    console.warn('Analytics not available', e);\n  }\n}\nexport function trackEvent(eventName, params = {}) {\n  if (!analyticsInstance) return;\n  try {\n    logEvent(analyticsInstance, eventName, params);\n  } catch (e) {\n    console.warn('Event tracking failed', e);\n  }\n}\n\n// Request notification permission and fetch token\nexport async function requestFcmToken() {\n  if (!messagingInstance) return null;\n  const permission = await Notification.requestPermission();\n  if (permission !== 'granted') {\n    console.log('Notification permission denied');\n    return null;\n  }\n  try {\n    const vapidKey = process.env.REACT_APP_FIREBASE_VAPID_KEY; // Public VAPID key\n    const currentToken = await getToken(messagingInstance, {\n      vapidKey\n    });\n    if (currentToken) {\n      console.log('FCM token:', currentToken);\n      // Persist token to backend if configured\n      try {\n        const backend = process.env.REACT_APP_BACKEND_URL;\n        if (backend) {\n          await fetch(`${backend.replace(/\\/$/, '')}/api/push/register`, {\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n              token: currentToken\n            })\n          });\n        }\n      } catch (e) {\n        console.warn('Token persistence failed', e);\n      }\n      return currentToken;\n    } else {\n      console.log('No registration token available.');\n      return null;\n    }\n  } catch (err) {\n    console.error('An error occurred while retrieving token.', err);\n    return null;\n  }\n}\nexport function listenForegroundMessages(callback) {\n  if (!messagingInstance) return;\n  onMessage(messagingInstance, payload => {\n    console.log('Foreground message received', payload);\n    if (callback) callback(payload);\n  });\n}","map":{"version":3,"names":["initializeApp","getMessaging","getToken","onMessage","getAnalytics","logEvent","firebaseConfig","apiKey","process","env","REACT_APP_FIREBASE_API_KEY","authDomain","REACT_APP_FIREBASE_AUTH_DOMAIN","projectId","REACT_APP_FIREBASE_PROJECT_ID","storageBucket","REACT_APP_FIREBASE_STORAGE_BUCKET","messagingSenderId","REACT_APP_FIREBASE_MESSAGING_SENDER_ID","appId","REACT_APP_FIREBASE_APP_ID","measurementId","REACT_APP_FIREBASE_MEASUREMENT_ID","messagingInstance","analyticsInstance","initFirebase","app","e","console","warn","initAnalytics","REACT_APP_ENABLE_ANALYTICS","consent","localStorage","getItem","log","trackEvent","eventName","params","requestFcmToken","permission","Notification","requestPermission","vapidKey","REACT_APP_FIREBASE_VAPID_KEY","currentToken","backend","REACT_APP_BACKEND_URL","fetch","replace","method","headers","body","JSON","stringify","token","err","error","listenForegroundMessages","callback","payload"],"sources":["C:/Users/kutum/Documents/room-rental-platform/src/firebase.js"],"sourcesContent":["// Firebase client initialization for Room24\r\n// Replace placeholder environment variables with real Firebase project config.\r\n// Ensure you have added a web app in Firebase console and enabled Cloud Messaging.\r\n\r\nimport { initializeApp } from 'firebase/app';\r\nimport { getMessaging, getToken, onMessage } from 'firebase/messaging';\r\nimport { getAnalytics, logEvent } from 'firebase/analytics';\r\n\r\nconst firebaseConfig = {\r\n  apiKey: process.env.REACT_APP_FIREBASE_API_KEY,\r\n  authDomain: process.env.REACT_APP_FIREBASE_AUTH_DOMAIN,\r\n  projectId: process.env.REACT_APP_FIREBASE_PROJECT_ID,\r\n  storageBucket: process.env.REACT_APP_FIREBASE_STORAGE_BUCKET,\r\n  messagingSenderId: process.env.REACT_APP_FIREBASE_MESSAGING_SENDER_ID,\r\n  appId: process.env.REACT_APP_FIREBASE_APP_ID,\r\n  measurementId: process.env.REACT_APP_FIREBASE_MEASUREMENT_ID,\r\n};\r\n\r\nlet messagingInstance;\r\nlet analyticsInstance;\r\n\r\nexport function initFirebase() {\r\n  const app = initializeApp(firebaseConfig);\r\n  try {\r\n    messagingInstance = getMessaging(app);\r\n  } catch (e) {\r\n    console.warn('Messaging not available', e);\r\n  }\r\n  return app;\r\n}\r\n\r\nexport function initAnalytics(app) {\r\n  if (process.env.REACT_APP_ENABLE_ANALYTICS !== 'true') return;\r\n  const consent = localStorage.getItem('analytics-consent');\r\n  if (consent !== 'yes') return;\r\n  try {\r\n    analyticsInstance = getAnalytics(app);\r\n    console.log('Analytics initialized');\r\n  } catch (e) {\r\n    console.warn('Analytics not available', e);\r\n  }\r\n}\r\n\r\nexport function trackEvent(eventName, params = {}) {\r\n  if (!analyticsInstance) return;\r\n  try {\r\n    logEvent(analyticsInstance, eventName, params);\r\n  } catch (e) {\r\n    console.warn('Event tracking failed', e);\r\n  }\r\n}\r\n\r\n// Request notification permission and fetch token\r\nexport async function requestFcmToken() {\r\n  if (!messagingInstance) return null;\r\n  const permission = await Notification.requestPermission();\r\n  if (permission !== 'granted') {\r\n    console.log('Notification permission denied');\r\n    return null;\r\n  }\r\n  try {\r\n    const vapidKey = process.env.REACT_APP_FIREBASE_VAPID_KEY; // Public VAPID key\r\n    const currentToken = await getToken(messagingInstance, { vapidKey });\r\n    if (currentToken) {\r\n      console.log('FCM token:', currentToken);\r\n      // Persist token to backend if configured\r\n      try {\r\n        const backend = process.env.REACT_APP_BACKEND_URL;\r\n        if (backend) {\r\n          await fetch(`${backend.replace(/\\/$/, '')}/api/push/register`, {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({ token: currentToken })\r\n          });\r\n        }\r\n      } catch (e) {\r\n        console.warn('Token persistence failed', e);\r\n      }\r\n      return currentToken;\r\n    } else {\r\n      console.log('No registration token available.');\r\n      return null;\r\n    }\r\n  } catch (err) {\r\n    console.error('An error occurred while retrieving token.', err);\r\n    return null;\r\n  }\r\n}\r\n\r\nexport function listenForegroundMessages(callback) {\r\n  if (!messagingInstance) return;\r\n  onMessage(messagingInstance, payload => {\r\n    console.log('Foreground message received', payload);\r\n    if (callback) callback(payload);\r\n  });\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}